Дата: 28.12.2023
В данном документе рассмотрены варианты по реорганизации работы команд G.Control и S.Control:
1. S.Control, как Тенант G.Control в Yandex Cloud.
2. Поточная передача фичей от S.Control к G.Control.

## Наши цели
1. Продавать ПО для застройщиков, взяв за основу функциональность S.Продуктов и адаптировать ее для рынка.
2. Выйти на самоокупаемость, а в дальнейшем прибыльность.
3. Новые фичи S.Продуктов должны максимально быстро попадать клиенту, качество ПО должно быть на высоком уровне.
4. Единые продукты с точки зрения основных функциональностей. Различие только в 10-15% фичей. Единая навигация, UX, адаптивный UI под заказчика.
5. Для реализации целей возможна заморозка новых фичей S.Control на 1-2 квартала.
6. Минимизация численности команд, в идеале убрать дублирование.
7. Нет полного форка, в части кода приложения -> S.Control и G.Control работают на одной кодовой базе (одна ветка в git)
## Вводные (AS IS)
1. G.Control и S.Control разные приложения:
	1. Бизнес-логика G.Control <> Бизнес-логике S.Control
	2. Модель данных G.Control <> Модели данных S.Control (Разная модель данных)
2. В коде S.Control есть функционал для Рембригад (Функционал не характерный для G.Control)

Можно сказать, что это разные приложения, как, например, S.Control и S.Home.

## Cхема работы S.Control

![[Pasted image 20231228103920.png]]
## Cхема работы G.Control (Мультитенант)

![[Pasted image 20231228104130.png]]
## Вариант 1: S.Control, как Тенант G.Control в Yandex Cloud
### Архитектура

![[Pasted image 20231228104826.png]]
### Технические задачи
В данном разделе описаны технические задачи, которые нужно решить. Перечень не полный, но позволяет понять объем работ и сложность проекта.

| Задача | Сложность | Зависимость | Комментарий |
| - | - | - | - |
| Миграция кода G.Control в S.Control | 5 | Текущие задачи продуктовых команд, команд DevOps, ЦСПБ, Безопасность, DWH, Домиленд| Проект повышенной сложности. Много зависимостей от смежных подразделений Самолета и B2B партнеров: ЦСПБ, Безопасность, DWH, Домиленд. Нужен выделенный человек, который будет это делать 100% времени. |
| Миграция пользователей из S.Control в G.Control и Keycloak | 2 | S.PaaS |  |
| Интеграция: Kafka Самолет | 4 | ЦСПБ, Безопасность| Доступ к нашей Kafka -> Нужно будет пройти боссов в виде нашей безопасности и ЦСПБ (они не быстро все делают) |
| Интеграция: Debezium | 4 | DWH, ЦСПБ, Безопасность| Интеграция на уровне БД -> DWH должны будут подключиться к Yandex Cloud -> Если не сделать, то отчетности не будет |
| Интеграция: HTTP/REST | 5 | Домиленд| Двунаправленная B2B интеграция -> Тут нужно разбираться, но точно можно сказать, что на стороне Домиленда потребуются изменения |
| Интеграция: Direct DB | 4 | ЦСПБ, Безопасность| БД где хранятся геоданные пользователей -> Нужно делать доступ до этой БД |
| Интеграция: S3-minio | 2 | | - |
| Интеграция: Микрофронты | 2 | ЦСПБ, Безопасность | S.Calendar и S.Progress должны быть доступны для Yandex Cloud |
| Интеграция: Metabase, TenData | 3 | Безопасность| Нужно согласовать доступ |
| Техническое лидирование проекта | 5 | | Придумать, как это сделать, учитывая все вводные. |
| Управление проектом| 5 | | Проект повышенной сложности. Много зависимостей от смежных подразделений Самолета и B2B партнеров: ЦСПБ, Безопасность, DWH, Домиленд. Нужен выделенный человек, который будет это делать 100% времени. |

Помимо задач, перечисленных в таблице: 
1. Сейчас приложение передано в Дежурную смену на мониторинг. При переходе в Yandex Cloud приложение снимут с мониторинга.
2. Сейчас у нас есть выделенный DBA, к которому мы можем обратиться с любым вопросом по работе БД. При переходе в Yandex Cloud этого не будет.
3. Для S.Продуктов мы собираем метрики с помощью Sentry, в Yandex Cloud будет другой инструмент -> технические метрики стабильности отвалятся (LCP, Apdex)
### Ключевые выводы
1. Все технические задачи, описанные выше - это большие/средние и сложные задачи, которые нужно прорабатывать отдельно. Задачу по миграции кода S.Control и G.Control мы уже проходили, успехом она не увенчалась.
2. Проект повышенной сложности.
3. Много зависимостей от смежных подразделений Самолета и B2B партнеров: ЦСПБ, Безопасность, DWH, Домиленд.
4. Большие вызовы для команды DevOps и команд разработки.
5. **80% работы, которая делала команда G.Control в 2023г. уйдет в стол и автотесты тоже.**
6. Тенант Самолет не вписывается в концепцию SaaS-решения, т.к. имеет много интеграционной специфики, которая не нужна другим Тенантам. Тем самым, поддержка такого решения будет весьма сложна для команды, а сам код содержать много специфики для Тенанта Самолет. Для таких заказчиков обычно выделяют Private Cloud или On Premise - у нас так уже сделано.
7. По срокам что-то сказать точно сложно, т.к. есть много неопределенностей с зависимостями и риск сойти на середине проекта, поняв, что есть блокер или поменялись приоритеты, который мы не можем решить. Моя оценка: 1 - 1.5 года, с вероятностью успеха 10%, при условии, что текущие команды уделяют 60% времени этому проекту и не меняют состав. Тут нужно отметить, что это простой перенос, доп ценности в продукте мы не создаем.
8. Если предположить, что мы успешно завершили проект, то все равно нужно ответить на вопросы:
	- Что делать с Рембригадами?
	- Сможет ли одна команда развивать и Глобал и Локал и Рембригады, при условии высокой загрузки со стороны Тенанта Самолет (Наши заказчики любят и знают Control, поэтому могут быть задачи вне контекстов контроля качества)?

## Вариант 2: Поточная передача фичей от S.Control к G.Control
### Архитектура

![[Pasted image 20231228113813.png]]
### Технические задачи
По сути, нужно выполнить одну сложную инженерную задачу: разработать регламент "Поточной передачи фичей" от S.Control к G.Control и наоборот.

Основные поинты регламента:
1. В S.Control и G.Control логически выделяются фичи.
2. Для каждой логической фичи разрабатывается артефакты:
	- Исходники (код, автотесты, bundle);
	- Описание функционала;
	- Инструкция по развертыванию;
	- Инструкция по использованию.
3. Требования к исходникам: должны отчуждаемы (независимы), учитывать структуру проекта смежного продукта и его функционал.
4. При разработке новых фичей, нужно планировать подготовку артефактов для другой команды.
5. Придерживаться концепции новая фича - новые экраны (представления). На это потом можно наложить лицензионную политику (доступ к экранам основной функциональности, доступ к экранам доп.функциональности за отдельную плату)
### Бизнес-процесс
1. При планировании спринта идет маркировка фичей, которые нужны смежному продукту.
2. Маркированные фичи разрабатываются согласно регламенту.
### Структурные изменения
Тут пространство для маневра. Это может быть одна команда, которая владеет ~~двумя~~(четырьмя, не забываем Рембригады и Календарь) продуктами (главное, чтобы она это осилила) или две команды, как есть сейчас.
Для реализации цели "Минимизация численности команд, в идеале убрать дублирование" можно оперировать не количеством команд, а количеством людей в командах. Для эффективного использования ресурсов и более быстрого и качественного процесса передачи фичей нужно шарить экспертизу и **ответственность** (транслировать им, что это наше общее и вы все к этому причастны) между командами разработки G.Control и S.Control.
### Ключевые выводы
1. Понятная инженерная задача.
2. Нет зависимости, бОльшая гибкость: возможность управлять фичами и не держать в кодовой базе то, что не нужно; возможность разного релизного цикла; стабильность приложения.
3. Для реализации возможно потребуется заморозить реализацию новых фичей или уменьшить производительность на ~ квартал. Нужно для внедрения регламента "Поточной поставки фичей".
4. Разработка маркированных фичей замедлится, т.к. нужно будет выполнить требования регламента.